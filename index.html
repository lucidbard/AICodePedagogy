<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Digital Archaeology Mystery</title>

  <!-- Google Fonts for Colab-style appearance -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link
    href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&family=Roboto+Mono:wght@400;500&display=swap"
    rel="stylesheet">

  <script src="https://unpkg.com/skulpt@0.11.1/dist/skulpt.min.js"
    onload="if(window.onSkulptLoaded) window.onSkulptLoaded(); console.log('Skulpt core loaded')"
    onerror="loadSkulptFallback()"></script>
  <script src="https://unpkg.com/skulpt@0.11.1/dist/skulpt-stdlib.js" onload="console.log('Skulpt stdlib loaded')"
    onerror="console.error('Failed to load Skulpt stdlib')"></script>
  <script>    // Fallback function to load Skulpt from alternative CDN
    function loadSkulptFallback() {
      console.log('Trying fallback CDN for Skulpt...');
      const script1 = document.createElement('script');
      script1.src = 'https://cdnjs.cloudflare.com/ajax/libs/skulpt/0.11.1/skulpt.min.js';
      script1.onload = () => {
        console.log('Skulpt loaded from fallback');
        if (window.onSkulptLoaded) window.onSkulptLoaded();
      };
      script1.onerror = () => console.error('All CDNs failed for Skulpt');
      document.head.appendChild(script1);

      const script2 = document.createElement('script');
      script2.src = 'https://cdnjs.cloudflare.com/ajax/libs/skulpt/0.11.1/skulpt-stdlib.js';
      script2.onload = () => console.log('Skulpt stdlib loaded from fallback');
      document.head.appendChild(script2);
    }
  </script>

  <!-- CodeMirror for syntax highlighting -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/codemirror.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/theme/material-darker.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/codemirror.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/mode/python/python.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/addon/edit/closebrackets.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/addon/edit/matchbrackets.min.js"></script>

  <link rel="stylesheet" href="style.css" />
</head>

<body>
  <div class="container">
    <div class="header">
      <h1 id="game-title">ğŸ›ï¸ Digital Archaeology Mystery</h1>
      <p class="subtitle" id="game-subtitle">Code Your Way Through Ancient Secrets</p>
      <div class="progress-bar">
        <div class="progress-fill" id="progress-bar"></div>
      </div>
    </div>

    <div class="game-area">
      <div class="story-panel">
        <h2>The Mystery</h2>
        <div class="story-text" id="story-content">
          <!-- Story content will be loaded here -->
        </div>
        <div class="challenge-text" id="challenge-content">
          <!-- Challenge description will be loaded here -->
        </div>
        <div class="data-text" id="data-content">
          <!-- Data description will be loaded here -->
        </div>
      </div>
      <div class="code-panel">
        <h2>Your Code</h2>
        <div id="cells-container">
          <!-- For multi-cell stages -->
        </div>
        <div id="single-cell-container">
          <!-- For single-cell stages - will be dynamically populated -->
        </div>
        <div class="hint-section">
          <div id="hints-container">
            <!-- Hint buttons will be generated here -->
          </div>
          <div id="hint-text-container">
            <!-- Hint text will appear here -->
          </div>
        </div>
        <div class="runtime-controls">
          <button class="restart-runtime-button" id="restart-runtime-button"
            title="Clear all cell outputs and reset runtime (similar to restarting a Jupyter kernel)">ğŸ”„ Restart
            Runtime</button>
        </div>
        <button class="next-button" id="next-button">Continue to Next Stage â†’</button>
      </div>
    </div>
  </div>

  <!-- Developer navigation for testing -->
  <button class="dev-nav-toggle" id="dev-nav-toggle">âš™</button>
  <div class="dev-nav" id="dev-nav">
    <!-- Stage navigation buttons will be generated here -->
  </div>
  <!-- Celebration effect container -->
  <div class="celebration" id="celebration"></div>

  <!-- LLM Assistant Footer -->
  <footer class="llm-footer">
    <div class="llm-footer-content">
      <div class="llm-toggle-container">
        <label class="llm-toggle">
          <input type="checkbox" id="llm-enabled" />
          <span class="llm-slider"></span>
          <span class="llm-label">ğŸ¤– AI Assistant</span>
        </label>
      </div>
      <div class="llm-settings" id="llm-settings" style="display: none;">
        <span class="llm-model-info" id="llm-model-info">No model selected</span>
        <button id="change-model" class="change-model-btn" title="Change AI model">Change Model</button>
        <div class="model-selection" id="model-selection" style="display: none;">
          <select id="model-select">
            <option value="">Select a model...</option>
          </select>
          <button id="refresh-models" class="refresh-btn" title="Refresh available models">ğŸ”„</button>
        </div>
      </div>
      <div class="llm-status" id="llm-status"></div>
    </div>
  </footer>

  <script src="script.js"></script>
</body>

</html>